<div th:insert="~{header.html}"></div>
<div>

    <section class="section">
        <div class="section-body">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-light">
                            <div class="w-100 d-flex justify-content-between align-items-end">
                                <h4 class="color-primary">Create Order</h4>
                                <a href="http://asia.intels.co/projects/laravel/stripe/public/orders"
                                   class="btn btn-lg btn-primary rounded"><i class="fas fa-wrench mr-1"></i> Manage
                                    Order</a>
                            </div>
                        </div>

                        <!--                        <form action="http://asia.intels.co/projects/laravel/stripe/public/orders" method="POST" enctype="multipart/form-data">-->
                        <form>
                            <input type="hidden" name="id">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class='mb-2'><label>Style Id</label>
                                            <div class=''><select name='cmbStyleId' id='cmbStyleId'
                                                                  class='form-control'>
                                                <option value='1'>ST123</option>
                                                <option value='2'>ST401</option>
                                            </select></div>
                                        </div>
                                        <div class='mb-2'><label>Buyer Id</label>
                                            <div class=''><select name='cmbBuyerId' id='cmbBuyerId'
                                                                  class='form-control'>
                                                <option value='1'>ARC</option>
                                                <option value='2'>High Ltd</option>
                                            </select></div>
                                        </div>
                                        <label>Shipping Address</label>
                                        <textarea name="txtShippingAddress" id="txtShippingAddress"
                                                  class="form-control"></textarea>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class='mb-2'><label for='txtOrderDate' class=''>Order Date</label>
                                            <div class=''><input type='date' class='form-control' name='txtOrderDate'
                                                                 id='txtOrderDate' value='' placeholder=''></div>
                                        </div>
                                        <div class='mb-2'><label for='txtDeliveryDate' class=''>Delivery Date</label>
                                            <div class=''><input type='date' class='form-control' name='txtDeliveryDate'
                                                                 id='txtDeliveryDate' value='' placeholder=''></div>
                                        </div>
                                        <div class='mb-2'><label>Status</label>
                                            <div class=''><select name='cmbStatusId' id='cmbStatusId'
                                                                  class='form-control'>
                                                <option value='1'>Invoiced</option>
                                                <option value='2'>Processing</option>
                                                <option value='3'>Shifted</option>
                                                <option value='4'>Delivered</option>
                                            </select></div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <hr>
                                        <h6 class="color-primary">Add Item Details</h6>
                                    </div>
                                    <div class="col mx-auto">
                                        <div class='mb-2'><label>Size Id</label>
                                            <div class=''><select name='cmbSizeId' id='cmbSizeId' class='form-control'>
                                                <option value='1'>XXS</option>
                                                <option value='2'>XS</option>
                                                <option value='3'>S</option>
                                                <option value='4'>M</option>
                                                <option value='5'>L</option>
                                                <option value='6'>XL</option>
                                                <option value='7'>XXL</option>
                                            </select></div>
                                        </div>
                                    </div>
                                    <div class="col mx-auto">
                                        <div class='mb-2'><label for='txtQuantity' class=''>Quantity</label>
                                            <div class=''><input type='text' class='form-control' name='txtQuantity'
                                                                 id='txtQuantity' value='1' placeholder=''></div>
                                        </div>
                                    </div>
                                    <div class="col mx-auto">
                                        <div class='mb-2'><label for='txtPrice' class=''>Price</label>
                                            <div class=''><input type='text' class='form-control' name='txtPrice'
                                                                 id='txtPrice' value='0' placeholder=''></div>
                                        </div>
                                    </div>
                                    <div class="col mx-auto">
                                        <div class='mb-2'><label for='txtDiscount' class=''>Discount</label>
                                            <div class=''><input type='text' class='form-control' name='txtDiscount'
                                                                 id='txtDiscount' value='0' placeholder=''></div>
                                        </div>
                                    </div>
                                    <div class="col mx-auto">
                                        <div class='mb-2'><label for='vat' class=''>Vat</label>
                                            <div class=''><input type='text' class='form-control' name='vat' id='vat'
                                                                 value='0' placeholder=''></div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <input type="button" id="btnAddToCart" name="btnAddToCart"
                                               class="btn btn-sm btn-outline-dark" value="Add item"/>
                                        <input type="button" id="clearAll" class="btn btn-sm btn-outline-danger"
                                               value="Empty"/>
                                        <table class="table table-striped table-sm ">
                                            <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>SL</th>
                                                <th>Size</th>
                                                <th class="text-right">Price</th>
                                                <th class="text-center">Quantity</th>
                                                <th class="text-right">Discount</th>
                                                <th class="text-right">Subtotal</th>
                                            </tr>
                                            </thead>
                                            <tbody id="items">

                                            </tbody>
                                        </table>
                                        <hr>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-5 order-lg-1 order-2">
                                        <div class='mb-2'><label for='txtRemark' class=''>Remarks</label>
                                            <div class=''><input type='text' class='form-control' name='txtRemark'
                                                                 id='txtRemark' value='' placeholder=''></div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 order-lg-2 order-1 ml-auto bg-light">
                                        <table class="table table-striped text-right">
                                            <tfoot>
                                            <tr>
                                                <th>Subtotal</th>
                                                <th><input type="text" class="form-control form-control-sm text-right"
                                                           name="txtSubtotal" id="txtSubtotal" value="0"/></th>
                                            </tr>
                                            <tr class="d-none">
                                                <th></th>
                                                <th><input type="text" class="form-control form-control-sm text-right"
                                                           name="discount" id="discount" value="0"/></th>
                                            </tr>
                                            <tr>
                                                <th>VAT</th>
                                                <th><input type="text" class="form-control form-control-sm text-right"
                                                           name="txtVat" id="txtVat" value="0"/></th>
                                            </tr>
                                            <tr>
                                                <th>Paid Amount</th>
                                                <th><input type="text" class="form-control form-control-sm text-right"
                                                           name="txtPaidAmount" id="txtPaidAmount" value="0"/></th>
                                            </tr>
                                            <tr>
                                                <th>Due Amount</th>
                                                <th><input type="text"
                                                           class="form-control form-control-sm text-right text-danger"
                                                           name="txtDueAmount" id="txtDueAmount" value="0"/></th>
                                            </tr>
                                            <tr>
                                                <th>Total</th>
                                                <th><input type="text"
                                                           class="form-control form-control-sm text-right h6"
                                                           name="txtTotalAmount" id="txtTotalAmount" value="0"/></th>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer border-top">
                                <input type='button' value='Create' name='btnProcessOrder' id='btnProcessOrder'
                                       class='btn btn-info'/>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    $(function (){
        const cart = new Cart("order");
        //on page calculation
        printCart();
        //add item to bill
        $("#btnAddToCart").on("click",function (){
            let item_id = $("#cmbSizeId").val();
            let name = $("#cmbSizeId option:selected").text();
            let price = $("#txtPrice").val();
            let qty = $("#txtQuantity").val();
            let discount = $("#txtDiscount").val();
            let vat = $("#vat").val();

            let total_discount = discount * qty;
            let subtotal = price * qty - total_discount;

            let item ={
                "name":name,
                "item_id":item_id,
                "price":price,
                "qty":parseFloat(qty),
                "discount":discount,
                "vat":vat,
                "total_discount":total_discount,
                "subtotal":subtotal
            };
            cart.save(item);
            printCart();
        })
        // delete row
        $("body").on("click",".delete",function (){
            let id = $(this).data("id");
            cart.delItem(id);
            printCart();
        })
        // delete row end
        // clear row
        $("#clearAll").on("click",function (){
            cart.clearCart();
            printCart();
        })
        // clear row end
        // printCart method
        function printCart(){
            let lists = cart.getCart();
            let sn=1;
            let $bill="";
            let discount = 0;
            let subtotal = 0;
            if (lists !=null){
                lists.forEach(function (item,i){
                    console.log(item,name);
                    subtotal +=(item.price - item.discount) * item.qty;
                    let $html ="<tr>";
                    $html += "<td>";
                    $html += "<input type='button' class='delete btn btn-sm btn-outline-danger py-0 px-2 rounded-circle'" +
                        "data-id =' "+item.item_id+" ' value='x'/>";
                    $html += "</td>";
                    $html += "<td>";
                    $html += sn;
                    $html += "</td>";
                    $html += "<td>";
                    $html += item.name;
                    $html += "</td>";
                    $html += "<td data-field = 'price' class='text-end'>";
                    $html += item.price;
                    $html += "</td>";
                    $html += "<td data-field = 'qty' class='text-end'>";
                    $html += item.qty;
                    $html += "</td>";
                    $html += "<td data-field = 'discount' class='text-end'>";
                    $html += item.discount;
                    $html += "</td>";
                    $html += "<td data-field = 'subtotal' class='text-end'>";
                    $html += item.subtotal;
                    $html += "</td>";
                    $html += "</tr>";
                    $bill +=$html;
                    discount += item.total_discount
                    sn++;
                })
                ;
            }
            //sub table data
            $("#items").html($bill);
            //order summary
            $("#txtSubtotal").val(subtotal.toFixed());
            let tax = (subtotal *0.05).toFixed();
            if($("#txtTotalAmount").val() == 0){
                $("#txtPaidAmount").val(0.00);

            }
            let paid = $("#txtPaidAmount").val();
            $("#discount").val(discount);
            $("#txtVat").val(tax);
            if (paid == " "){paid =0}
            $("#txtDueAmount").val(parseFloat(subtotal) + parseFloat(tax) - parseFloat(paid));
            $("#txtTotalAmount").val(parseFloat(subtotal) + parseFloat(tax));

            $("#txtPaidAmount").on("keyup",function (){
                let total = $("#txtTotalAmount").val();
                let paid = parseFloat($("#txtPaidAmount").val());
                if(paid == " "){paid = 0}
                $("#txtDueAmoutn").val(total - paid);
            });
            //summary end

            //sub table data end

        }
        // printCart method end
        //add item to bill end
        //on page calculation end
    })
</script>
<script src="assets/js/cart.js"></script>
<div th:insert="~{footer.html}"></div>
